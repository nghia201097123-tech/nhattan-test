-- =====================================================
-- Script: Seed Admin Account for SeedVault System
-- Database: seed_management
-- Run: psql -U seed_admin -d seed_management -f seed-admin.sql
-- =====================================================

-- Tạo bảng nếu chưa tồn tại (TypeORM sẽ tự tạo, nhưng để đảm bảo)
-- Bỏ qua nếu đã có

-- =====================================================
-- 1. Tạo Permissions (Quyền hạn)
-- =====================================================
INSERT INTO permissions (id, code, name, module, created_at) VALUES
  ('a1000000-0000-0000-0000-000000000001', 'users.view', 'Xem người dùng', 'users', NOW()),
  ('a1000000-0000-0000-0000-000000000002', 'users.create', 'Tạo người dùng', 'users', NOW()),
  ('a1000000-0000-0000-0000-000000000003', 'users.edit', 'Sửa người dùng', 'users', NOW()),
  ('a1000000-0000-0000-0000-000000000004', 'users.delete', 'Xóa người dùng', 'users', NOW()),
  ('a1000000-0000-0000-0000-000000000005', 'roles.view', 'Xem vai trò', 'roles', NOW()),
  ('a1000000-0000-0000-0000-000000000006', 'roles.create', 'Tạo vai trò', 'roles', NOW()),
  ('a1000000-0000-0000-0000-000000000007', 'roles.edit', 'Sửa vai trò', 'roles', NOW()),
  ('a1000000-0000-0000-0000-000000000008', 'roles.delete', 'Xóa vai trò', 'roles', NOW()),
  ('a1000000-0000-0000-0000-000000000009', 'samples.view', 'Xem mẫu giống', 'samples', NOW()),
  ('a1000000-0000-0000-0000-000000000010', 'samples.create', 'Tạo mẫu giống', 'samples', NOW()),
  ('a1000000-0000-0000-0000-000000000011', 'samples.edit', 'Sửa mẫu giống', 'samples', NOW()),
  ('a1000000-0000-0000-0000-000000000012', 'samples.delete', 'Xóa mẫu giống', 'samples', NOW()),
  ('a1000000-0000-0000-0000-000000000013', 'warehouse.view', 'Xem kho', 'warehouse', NOW()),
  ('a1000000-0000-0000-0000-000000000014', 'warehouse.import', 'Nhập kho', 'warehouse', NOW()),
  ('a1000000-0000-0000-0000-000000000015', 'warehouse.export', 'Xuất kho', 'warehouse', NOW()),
  ('a1000000-0000-0000-0000-000000000016', 'catalog.view', 'Xem danh mục', 'catalog', NOW()),
  ('a1000000-0000-0000-0000-000000000017', 'catalog.manage', 'Quản lý danh mục', 'catalog', NOW()),
  ('a1000000-0000-0000-0000-000000000018', 'reports.view', 'Xem báo cáo', 'reports', NOW())
ON CONFLICT (id) DO NOTHING;

-- =====================================================
-- 2. Tạo Roles (Vai trò)
-- =====================================================
INSERT INTO roles (id, code, name, description, created_at) VALUES
  ('b1000000-0000-0000-0000-000000000001', 'ADMIN', 'Quản trị viên', 'Toàn quyền quản trị hệ thống', NOW()),
  ('b1000000-0000-0000-0000-000000000002', 'MANAGER', 'Quản lý', 'Quản lý hoạt động nghiệp vụ', NOW()),
  ('b1000000-0000-0000-0000-000000000003', 'STAFF', 'Nhân viên', 'Nhân viên thao tác nghiệp vụ', NOW()),
  ('b1000000-0000-0000-0000-000000000004', 'VIEWER', 'Người xem', 'Chỉ có quyền xem', NOW())
ON CONFLICT (id) DO NOTHING;

-- =====================================================
-- 3. Gán quyền cho vai trò Admin (tất cả quyền)
-- =====================================================
INSERT INTO role_permissions (role_id, permission_id) VALUES
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000001'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000002'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000003'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000004'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000005'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000006'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000007'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000008'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000009'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000010'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000011'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000012'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000013'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000014'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000015'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000016'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000017'),
  ('b1000000-0000-0000-0000-000000000001', 'a1000000-0000-0000-0000-000000000018')
ON CONFLICT DO NOTHING;

-- =====================================================
-- 4. Tạo User Admin
-- Password: Admin@123 (đã hash bằng bcrypt)
-- =====================================================
INSERT INTO users (id, username, email, password_hash, full_name, phone, is_active, created_at, updated_at) VALUES
  ('c1000000-0000-0000-0000-000000000001', 'admin', 'admin@seedvault.com', '$2b$10$41vvXSy1eKryNL5leaqH/OW2H1OBTAmRj/Siqj907/kkkhERn.BYi', 'Administrator', '0901234567', true, NOW(), NOW())
ON CONFLICT (id) DO NOTHING;

-- =====================================================
-- 5. Gán vai trò Admin cho user admin
-- =====================================================
INSERT INTO user_roles (user_id, role_id) VALUES
  ('c1000000-0000-0000-0000-000000000001', 'b1000000-0000-0000-0000-000000000001')
ON CONFLICT DO NOTHING;

-- =====================================================
-- Thông báo hoàn thành
-- =====================================================
DO $$
BEGIN
  RAISE NOTICE '=====================================================';
  RAISE NOTICE 'Seed Admin Account Complete!';
  RAISE NOTICE '=====================================================';
  RAISE NOTICE 'Admin Account:';
  RAISE NOTICE '  Username: admin';
  RAISE NOTICE '  Password: Admin@123';
  RAISE NOTICE '  Email: admin@seedvault.com';
  RAISE NOTICE '=====================================================';
END $$;
